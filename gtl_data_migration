--=========city corporation pourashava master data
declare 
cursor tt is
select d.id,d.name,l.district from t_districts d, location_master l
where d.name=l.district;
begin
for i in tt loop
 update location_master
 set district_id=i.id
 where district=i.district;
 end loop;
 commit;
end;

insert into t_citycorp_pouroshava(
name, name_BN, IS_CCDR, DISTRICT_ID)
select distinct CITY_COR,CITY_COR_BN,decode(CCDR,'NO','0','YES','1'),DISTRICT_ID from location_master;
commit;

insert into t_wards (ward_no,district_id,CITYCORP_POUROSHAVA_NAME)
select ward_no,district_id,city_cor from location_master;
commit;

declare cursor tt is select c.id,c.name,c.district_id,l.ward_no from T_CITYCORP_POUROSHAVA c, location_master l
where c.name= l.CITY_COR;
begin
for i in tt loop
update t_wards set CITYCORP_POUROSHAVA_ID=i.id where ward_no=i.ward_no and district_id=i.district_id and CITYCORP_POUROSHAVA_NAME=i.name;
end loop;
commit;
end;

=====================================

declare cursor tt is 
select id,short_name from t_divisions;

begin
for i in tt loop
update t_admin_user
set loc_short_name=i.short_name
where location_id=i.id
and role_id=5;
end loop;
commit;
end;


declare cursor tt is 
select id,short_name from t_districts;

begin
for i in tt loop
update t_admin_user
set loc_short_name=i.short_name
where location_id=i.id
and role_id in (7,16);
end loop;
commit;
end;

declare cursor tt is
select d.id dis_id,SUBSTR(d.name, 1, 1) dis_short_name, u.id up_id, upper(substr(regexp_replace(u.name,'[^B, C, D, F, G, J, K, L, M, N, P, Q, S, T, V, X, Z, H, R, W, Y,
b, c, d, f, g, j, k, l, m, n, p, q, s, t, v, x, z, h, r, w, y]'),1,3)) up_short_name
from t_districts d, t_upazila u where d.id=u.district_id;

begin
for i in tt loop
update t_upazila set short_name=concat(i.dis_short_name,i.up_short_name)
where id=i.up_id;
end loop;
commit;
end;


declare cursor tt is 
select id,short_name from t_upazila;

begin
for i in tt loop
update t_admin_user
set loc_short_name=i.short_name
where location_id=i.id
and role_id in (9,10,17);
end loop;
commit;
end;

